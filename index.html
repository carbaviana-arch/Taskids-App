import React, { useState } from 'react';
import { Calendar, Clock, Target, Trophy, CheckCircle, Plus, Edit3, Trash2, Star, Heart } from 'lucide-react';
import { motion, AnimatePresence } from 'framer-motion';

// Componente LifeBar (Rediseñado)
const LifeBar = ({ currentPoints, maxPoints = 125 }) => {
  const percentage = Math.min((currentPoints / maxPoints) * 100, 100);
  const barWidth = `${percentage}%`;
  
  // Determinar color basado en porcentaje con tonos suaves y sombra
  let barColor;
  let shadowColor;
  if (percentage >= 75) {
    barColor = 'from-green-500 to-emerald-500';
    shadowColor = 'shadow-green-500/50';
  } else if (percentage >= 50) {
    barColor = 'from-blue-500 to-cyan-500';
    shadowColor = 'shadow-blue-500/50';
  } else if (percentage >= 25) {
    barColor = 'from-yellow-500 to-amber-500';
    shadowColor = 'shadow-yellow-500/50';
  } else {
    barColor = 'from-red-500 to-pink-500';
    shadowColor = 'shadow-red-500/50';
  }

  return (
    <div className={`w-full bg-gray-700/50 backdrop-blur-sm rounded-full h-7 border border-white/30 overflow-hidden shadow-2xl ${shadowColor} relative`}> 
      {/* Barra de progreso principal */}
      <motion.div
        className={`h-full bg-gradient-to-r ${barColor} relative overflow-hidden flex items-center justify-center`}
        style={{ width: barWidth }}
        initial={{ width: 0 }}
        animate={{ width: barWidth }}
        transition={{ duration: 0.8, ease: "easeOut" }}
      >
        {/* Efecto de brillo animado */}
        <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"></div>
      </motion.div>
      
      {/* Texto de HP centrado sobre la barra */}
      <div className="absolute inset-0 flex items-center justify-center pointer-events-none"> 
        <span className="text-white text-sm font-extrabold drop-shadow-md flex items-center">
            <Heart className="w-4 h-4 mr-1 text-red-400" />
            {currentPoints} / {maxPoints} HP
        </span>
      </div>
    </div>
  );
};

const App = () => {
  const [activeTab, setActiveTab] = useState('daily');
  const [dailyActivities, setDailyActivities] = useState([
    { id: 1, name: 'Hacer la cama', completed: false, reward: 10 },
    { id: 2, name: 'Ordenar juguetes', completed: true, reward: 15 },
    { id: 3, name: 'Tareas escolares', completed: false, reward: 20 }
  ]);
  
  const [schedule, setSchedule] = useState([
    { id: 1, time: '08:00', endTime: '08:30', activity: 'Desayuno', day: 'monday' },
    { id: 2, time: '09:00', endTime: '11:00', activity: 'Clases', day: 'monday' },
    { id: 3, time: '12:00', endTime: '12:30', activity: 'Almuerzo', day: 'tuesday' }
  ]);
  
  const [agenda, setAgenda] = useState([
    { 
      id: 1, 
      date: '2025-11-26', 
      time: '10:00', 
      eventType: 'Examen', 
      subject: 'Matemáticas', 
      comments: 'Preparar temas de álgebra',
      completed: false 
    },
    { 
      id: 2, 
      date: '2025-11-28', 
      time: '15:00', 
      eventType: 'Reunión', 
      subject: 'Padres', 
      comments: 'Entrevista con el director',
      completed: true 
    },
    { 
      id: 3, 
      date: '2025-12-01', 
      time: '09:30', 
      eventType: 'Visita', 
      subject: 'Médico', 
      comments: 'Chequeo anual',
      completed: false 
    }
  ]);
  
  const [rewards, setRewards] = useState([
    { id: 1, name: '30 minutos de videojuegos', cost: 50, unlocked: true },
    { id: 2, name: 'Helado especial', cost: 75, unlocked: false },
    { id: 3, name: 'Nueva skin de Fortnite', cost: 150, unlocked: false }
  ]);
  
  const [totalPoints, setTotalPoints] = useState(25);
  const [showAddModal, setShowAddModal] = useState(false);
  const [showEditModal, setShowEditModal] = useState(false); // Unificado para Daily y Agenda
  const [showEditScheduleModal, setShowEditScheduleModal] = useState(false);
  const [showEditRewardModal, setShowEditRewardModal] = useState(false);
  const [modalType, setModalType] = useState('');
  const [editingEvent, setEditingEvent] = useState(null);
  const [editingScheduleItem, setEditingScheduleItem] = useState(null);
  const [editingReward, setEditingReward] = useState(null);
  const [newItem, setNewItem] = useState({ 
    name: '', 
    time: '', 
    endTime: '',
    day: '',
    date: '', 
    cost: '', 
    activity: '',
    eventType: '',
    subject: '',
    comments: ''
  });

  const toggleActivity = (id, type) => {
    if (type === 'daily') {
      const activity = dailyActivities.find(a => a.id === id);
      if (activity) {
        setDailyActivities(prev => prev.map(a => 
          a.id === id 
            ? { ...a, completed: !a.completed } 
            : a
        ));
        // Actualizar puntos
        if (!activity.completed) {
          setTotalPoints(prev => prev + activity.reward);
        } else {
          setTotalPoints(prev => prev - activity.reward);
        }
      }
    } else if (type === 'agenda') {
      setAgenda(prev => prev.map(event => 
        event.id === id 
          ? { ...event, completed: !event.completed } 
          : event
      ));
    }
  };

  const addNewItem = () => {
    // Implementación original...
    if (modalType === 'daily') {
      const newItemObj = {
        id: Date.now(),
        name: newItem.name,
        completed: false,
        reward: parseInt(newItem.cost) || 10
      };
      setDailyActivities(prev => [...prev, newItemObj]);
    } else if (modalType === 'schedule') {
      if (newItem.time >= newItem.endTime) {
        alert('La hora de fin debe ser mayor que la hora de inicio');
        return;
      }
      const newItemObj = {
        id: Date.now(),
        time: newItem.time,
        endTime: newItem.endTime,
        activity: newItem.activity,
        day: newItem.day
      };
      setSchedule(prev => [...prev, newItemObj]);
    } else if (modalType === 'agenda') {
      const newItemObj = {
        id: Date.now(),
        date: newItem.date,
        time: newItem.time,
        eventType: newItem.eventType,
        subject: newItem.subject,
        comments: newItem.comments,
        completed: false
      };
      setAgenda(prev => [...prev, newItemObj]);
    } else if (modalType === 'reward') {
      const newItemObj = {
        id: Date.now(),
        name: newItem.name,
        cost: parseInt(newItem.cost) || 25,
        unlocked: false
      };
      setRewards(prev => [...prev, newItemObj]);
    }
    
    setNewItem({ 
      name: '', 
      time: '', 
      endTime: '',
      day: '',
      date: '', 
      cost: '', 
      activity: '',
      eventType: '',
      subject: '',
      comments: ''
    });
    setShowAddModal(false);
  };

  // Funciones de edición unificadas:
  
  const editEvent = (event) => { // Para Agenda
    setEditingEvent(event);
    setNewItem({
      date: event.date,
      time: event.time,
      eventType: event.eventType,
      subject: event.subject,
      comments: event.comments
    });
    setModalType('agenda');
    setShowEditModal(true);
  };

  const editDailyActivity = (activity) => { // Para Daily
    setEditingEvent(activity);
    setNewItem({
      name: activity.name,
      cost: activity.reward
    });
    setModalType('daily');
    setShowEditModal(true);
  };

  const updateEvent = () => { // Guarda Agenda
    setAgenda(prev => prev.map(event => 
      event.id === editingEvent.id 
        ? { ...event, 
            date: newItem.date,
            time: newItem.time,
            eventType: newItem.eventType,
            subject: newItem.subject,
            comments: newItem.comments
          }
        : event
    ));
    setNewItem({ name: '', time: '', endTime: '', day: '', date: '', cost: '', activity: '', eventType: '', subject: '', comments: '' });
    setShowEditModal(false);
    setEditingEvent(null);
  };

  const updateDailyActivity = () => { // Guarda Daily
    setDailyActivities(prev => prev.map(activity => 
      activity.id === editingEvent.id 
        ? { ...activity, 
            name: newItem.name,
            reward: parseInt(newItem.cost) || 10
          }
        : activity
    ));
    setNewItem({ name: '', time: '', endTime: '', day: '', date: '', cost: '', activity: '', eventType: '', subject: '', comments: '' });
    setShowEditModal(false);
    setEditingEvent(null);
  };

  // Funciones de eliminación originales...
  const deleteEvent = (id) => {
    setAgenda(prev => prev.filter(event => event.id !== id));
  };

  const deleteDailyActivity = (id) => {
    setDailyActivities(prev => prev.filter(activity => activity.id !== id));
  };
  
  const editScheduleItem = (item) => {
    setEditingScheduleItem(item);
    setNewItem({
      time: item.time,
      endTime: item.endTime || '',
      activity: item.activity,
      day: item.day
    });
    setShowEditScheduleModal(true);
  };

  const updateScheduleItem = () => {
    if (newItem.time >= newItem.endTime) {
      alert('La hora de fin debe ser mayor que la hora de inicio');
      return;
    }
    
    setSchedule(prev => prev.map(item => 
      item.id === editingScheduleItem.id 
        ? { ...item, 
            time: newItem.time,
            endTime: newItem.endTime,
            activity: newItem.activity,
            day: newItem.day
          }
        : item
    ));
    setNewItem({ name: '', time: '', endTime: '', day: '', date: '', cost: '', activity: '', eventType: '', subject: '', comments: '' });
    setShowEditScheduleModal(false);
    setEditingScheduleItem(null);
  };

  const deleteScheduleItem = (id) => {
    setSchedule(prev => prev.filter(item => item.id !== id));
  };

  const editReward = (reward) => {
    setEditingReward(reward);
    setNewItem({
      name: reward.name,
      cost: reward.cost
    });
    setShowEditRewardModal(true);
  };

  const updateReward = () => {
    setRewards(prev => prev.map(reward => 
      reward.id === editingReward.id 
        ? { ...reward, 
            name: newItem.name,
            cost: parseInt(newItem.cost) || 25
          }
        : reward
    ));
    setNewItem({ name: '', time: '', endTime: '', day: '', date: '', cost: '', activity: '', eventType: '', subject: '', comments: '' });
    setShowEditRewardModal(false);
    setEditingReward(null);
  };

  const deleteReward = (id) => {
    setRewards(prev => prev.filter(reward => reward.id !== id));
  };

  // FUNCIÓN DE CANJEO DE RECOMPENSAS (NUEVA)
  const redeemReward = (id, cost) => {
    if (totalPoints >= cost) {
      // Restar el costo de los puntos totales
      setTotalPoints(prev => prev - cost);
      
      // Marcar la recompensa como desbloqueada
      setRewards(prev => prev.map(reward => 
        reward.id === id 
          ? { ...reward, unlocked: true } 
          : reward
      ));
    } else {
      alert('¡Puntos insuficientes! Necesitas ' + (cost - totalPoints) + ' puntos más.');
    }
  };


  const renderDailyActivities = () => (
    <div className="space-y-4">
      {dailyActivities.map(activity => (
        <motion.div
          key={activity.id}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20"
        >
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              <button
                onClick={() => toggleActivity(activity.id, 'daily')}
                className={`w-8 h-8 rounded-full border-2 flex items-center justify-center ${
                  activity.completed 
                    ? 'bg-green-500 border-green-500' 
                    : 'border-white/30 hover:border-green-400'
                }`}
              >
                {activity.completed && <CheckCircle className="w-5 h-5 text-white" />}
              </button>
              <span className={`text-lg font-medium ${activity.completed ? 'line-through text-gray-400' : 'text-white'}`}>
                {activity.name}
              </span>
            </div>
            <div className="flex items-center space-x-2">
              <Star className="w-5 h-5 text-yellow-400" />
              <span className="text-yellow-400 font-bold">{activity.reward}</span>
              <div className="flex items-center space-x-1">
                <motion.button
                  whileHover={{ scale: 1.1 }}
                  whileTap={{ scale: 0.9 }}
                  onClick={() => editDailyActivity(activity)}
                  className="p-1 bg-blue-500 text-white rounded"
                >
                  <Edit3 className="w-4 h-4" />
                </motion.button>
                <motion.button
                  whileHover={{ scale: 1.1 }}
                  whileTap={{ scale: 0.9 }}
                  onClick={() => deleteDailyActivity(activity.id)}
                  className="p-1 bg-red-500 text-white rounded"
                >
                  <Trash2 className="w-4 h-4" />
                </motion.button>
              </div>
            </div>
          </div>
        </motion.div>
      ))}
      <motion.button
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        onClick={() => {
          setModalType('daily');
          setNewItem({ name: '', cost: '' });
          setShowAddModal(true);
        }}
        className="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-xl font-bold flex items-center justify-center space-x-2"
      >
        <Plus className="w-5 h-5" />
        <span>Añadir Actividad</span>
      </motion.button>
    </div>
  );

  const renderSchedule = () => (
    <div className="space-y-4">
      {schedule.map(item => (
        <motion.div
          key={item.id}
          initial={{ opacity: 0, x: -20 }}
          animate={{ opacity: 1, x: 0 }}
          className="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20 flex items-center justify-between"
        >
          <div className="flex items-center space-x-4">
            <Clock className="w-6 h-6 text-blue-400" />
            <div>
              <div className="text-lg font-medium text-white">{item.time} - {item.endTime}</div>
              <div className="text-gray-300">{item.activity} ({item.day})</div>
            </div>
          </div>
          <div className="flex items-center space-x-1">
            <motion.button
              whileHover={{ scale: 1.1 }}
              whileTap={{ scale: 0.9 }}
              onClick={() => editScheduleItem(item)}
              className="p-2 bg-blue-500 text-white rounded-lg"
            >
              <Edit3 className="w-4 h-4" />
            </motion.button>
            <motion.button
              whileHover={{ scale: 1.1 }}
              whileTap={{ scale: 0.9 }}
              onClick={() => deleteScheduleItem(item.id)}
              className="p-2 bg-red-500 text-white rounded-lg"
            >
              <Trash2 className="w-4 h-4" />
            </motion.button>
          </div>
        </motion.div>
      ))}
      <motion.button
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        onClick={() => {
          setModalType('schedule');
          setNewItem({ time: '', endTime: '', activity: '', day: '' });
          setShowAddModal(true);
        }}
        className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-bold flex items-center justify-center space-x-2"
      >
        <Plus className="w-5 h-5" />
        <span>Añadir Horario</span>
      </motion.button>
    </div>
  );

  const renderAgenda = () => (
    <div className="space-y-4">
      {agenda.map(event => (
        <motion.div
          key={event.id}
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20"
        >
          <div className="flex items-center justify-between mb-2">
            <div className="flex items-center space-x-3">
              <button
                onClick={() => toggleActivity(event.id, 'agenda')}
                className={`w-8 h-8 rounded-full border-2 flex items-center justify-center ${
                  event.completed 
                    ? 'bg-green-500 border-green-500' 
                    : 'border-white/30 hover:border-green-400'
                }`}
              >
                {event.completed && <CheckCircle className="w-5 h-5 text-white" />}
              </button>
              <div>
                <div className="text-lg font-medium text-white">{event.eventType}</div>
                <div className="text-gray-300">{event.subject}</div>
              </div>
            </div>
            <div className="flex items-center space-x-2">
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={() => editEvent(event)}
                className="p-2 bg-blue-500 text-white rounded-lg"
              >
                <Edit3 className="w-4 h-4" />
              </motion.button>
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={() => deleteEvent(event.id)}
                className="p-2 bg-red-500 text-white rounded-lg"
              >
                <Trash2 className="w-4 h-4" />
              </motion.button>
            </div>
          </div>
          <div className="grid grid-cols-2 gap-2 text-sm">
            <div className="text-gray-300">
              <Calendar className="w-4 h-4 inline mr-1" />
              {event.date}
            </div>
            <div className="text-gray-300">
              <Clock className="w-4 h-4 inline mr-1" />
              {event.time}
            </div>
          </div>
          {event.comments && (
            <div className="mt-2 text-sm text-gray-400 italic">
              "{event.comments}"
            </div>
          )}
        </motion.div>
      ))}
      <motion.button
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        onClick={() => {
          setModalType('agenda');
          setNewItem({ date: '', time: '', eventType: '', subject: '', comments: '' });
          setShowAddModal(true);
        }}
        className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 rounded-xl font-bold flex items-center justify-center space-x-2"
      >
        <Plus className="w-5 h-5" />
        <span>Añadir Evento</span>
      </motion.button>
    </div>
  );

  const renderRewards = () => (
    <div className="space-y-4">
      {rewards.map(reward => (
        <motion.div
          key={reward.id}
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          className={`bg-white/10 backdrop-blur-sm rounded-xl p-4 border ${
            reward.unlocked 
              ? 'border-yellow-400 bg-yellow-400/20' 
              : totalPoints >= reward.cost 
                ? 'border-green-400 bg-green-400/20' 
                : 'border-white/20'
          }`}
        >
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              <Trophy className={`w-6 h-6 ${reward.unlocked ? 'text-yellow-400' : 'text-gray-400'}`} />
              <div>
                <div className="text-lg font-bold text-white">{reward.name}</div>
                <div className="flex items-center space-x-1">
                  <Star className="w-4 h-4 text-yellow-400" />
                  <span className="text-yellow-400 font-bold">{reward.cost}</span>
                  <span className="text-gray-400">puntos</span>
                </div>
              </div>
            </div>
            <div className="flex items-center space-x-1">
              {/* Botones de edición y borrado */}
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={() => editReward(reward)}
                className="p-2 bg-blue-500 text-white rounded-lg"
              >
                <Edit3 className="w-4 h-4" />
              </motion.button>
              <motion.button
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={() => deleteReward(reward.id)}
                className="p-2 bg-red-500 text-white rounded-lg"
              >
                <Trash2 className="w-4 h-4" />
              </motion.button>
            </div>
            <div className="text-right">
              {/* Lógica de Canjeo */}
              {reward.unlocked ? (
                <span className="text-green-400 font-bold">¡Desbloqueado!</span>
              ) : totalPoints >= reward.cost ? (
                <motion.button
                  whileHover={{ scale: 1.1 }}
                  whileTap={{ scale: 0.9 }}
                  onClick={() => redeemReward(reward.id, reward.cost)} // Llama a la nueva función
                  className="bg-green-500 text-white px-3 py-1 rounded-lg font-bold"
                >
                  Canjear
                </motion.button>
              ) : (
                <span className="text-red-400">Necesitas {reward.cost - totalPoints} más</span>
              )}
            </div>
          </div>
        </motion.div>
      ))}
      <motion.button
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        onClick={() => {
          setModalType('reward');
          setNewItem({ name: '', cost: '' });
          setShowAddModal(true);
        }}
        className="w-full bg-gradient-to-r from-yellow-500 to-orange-500 text-white py-3 rounded-xl font-bold flex items-center justify-center space-x-2"
      >
        <Plus className="w-5 h-5" />
        <span>Añadir Recompensa</span>
      </motion.button>
    </div>
  );

  const renderContent = () => {
    switch (activeTab) {
      case 'daily': return renderDailyActivities();
      case 'schedule': return renderSchedule();
      case 'agenda': return renderAgenda();
      case 'rewards': return renderRewards();
      default: return renderDailyActivities();
    }
  };

  const getTabIcon = (tab) => {
    switch (tab) {
      case 'daily': return Target;
      case 'schedule': return Clock;
      case 'agenda': return Calendar;
      case 'rewards': return Trophy;
      default: return Target;
    }
  };

  const daysOfWeek = [
    { value: 'monday', label: 'Lunes' },
    { value: 'tuesday', label: 'Martes' },
    { value: 'wednesday', label: 'Miércoles' },
    { value: 'thursday', label: 'Jueves' },
    { value: 'friday', label: 'Viernes' },
    { value: 'saturday', label: 'Sábado' },
    { value: 'sunday', label: 'Domingo' }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-red-900 relative overflow-hidden">
      {/* Animated background elements */}
      <div className="absolute inset-0 opacity-20">
        <div className="absolute top-10 left-10 w-32 h-32 bg-red-500 rounded-full animate-pulse"></div>
        <div className="absolute top-32 right-20 w-24 h-24 bg-blue-500 rounded-full animate-bounce"></div>
        <div className="absolute bottom-20 left-1/4 w-16 h-16 bg-yellow-500 rounded-full animate-ping"></div>
        <div className="absolute bottom-40 right-1/3 w-20 h-20 bg-green-500 rounded-full animate-pulse"></div>
      </div>

      {/* Header (Modificado) */}
      <header className="relative z-10 p-4 border-b border-white/20 bg-black/30 backdrop-blur-sm">
        <div className="max-w-md mx-auto flex items-center justify-between">
          <h1 className="text-2xl font-bold text-white flex items-center">
            <Target className="w-8 h-8 mr-2 text-yellow-400" />
            Shukudai
          </h1>
          <div className="flex flex-col items-end w-40"> 
            <LifeBar currentPoints={totalPoints} maxPoints={125} />
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="relative z-10 p-4 pb-20">
        <div className="max-w-md mx-auto">
          {renderContent()}
        </div>
      </main>

      {/* Navigation Tabs */}
      <nav className="fixed bottom-0 left-0 right-0 bg-black/50 backdrop-blur-sm border-t border-white/20">
        <div className="max-w-md mx-auto flex justify-around">
          {['daily', 'schedule', 'agenda', 'rewards'].map((tab) => {
            const Icon = getTabIcon(tab);
            return (
              <motion.button
                key={tab}
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.9 }}
                onClick={() => setActiveTab(tab)}
                className={`flex flex-col items-center py-3 px-4 ${
                  activeTab === tab ? 'text-yellow-400' : 'text-gray-400'
                }`}
              >
                <Icon className="w-6 h-6 mb-1" />
                <span className="text-xs font-medium capitalize">
                  {tab === 'daily' ? 'Diario' : 
                   tab === 'schedule' ? 'Horario' : 
                   tab === 'agenda' ? 'Agenda' : 'Recompensas'}
                </span>
              </motion.button>
            );
          })}
        </div>
      </nav>

      {/* Add Modal (Sin cambios) */}
      <AnimatePresence>
        {showAddModal && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"
            onClick={() => setShowAddModal(false)}
          >
            <motion.div
              initial={{ scale: 0.8, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.8, opacity: 0 }}
              className="bg-gray-900 rounded-2xl p-6 w-full max-w-sm border border-white/20"
              onClick={(e) => e.stopPropagation()}
            >
              <h2 className="text-xl font-bold text-white mb-4 text-center">
                {modalType === 'daily' ? 'Nueva Actividad' :
                 modalType === 'schedule' ? 'Nuevo Horario' :
                 modalType === 'agenda' ? 'Nuevo Evento' :
                 'Nueva Recompensa'}
              </h2>
              
              {modalType === 'daily' && (
                <>
                  <input
                    type="text"
                    placeholder="Nombre de la actividad"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3 placeholder-gray-400"
                    value={newItem.name}
                    onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                  />
                  <input
                    type="number"
                    placeholder="Puntos de recompensa"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4 placeholder-gray-400"
                    value={newItem.cost}
                    onChange={(e) => setNewItem({...newItem, cost: e.target.value})}
                  />
                </>
              )}
              
              {modalType === 'schedule' && (
                <>
                  <input
                    type="text"
                    placeholder="Actividad"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3 placeholder-gray-400"
                    value={newItem.activity}
                    onChange={(e) => setNewItem({...newItem, activity: e.target.value})}
                  />
                  <input
                    type="time"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                    value={newItem.time}
                    onChange={(e) => setNewItem({...newItem, time: e.target.value})}
                  />
                  <input
                    type="time"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                    value={newItem.endTime}
                    onChange={(e) => setNewItem({...newItem, endTime: e.target.value})}
                  />
                  <select
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4"
                    value={newItem.day}
                    onChange={(e) => setNewItem({...newItem, day: e.target.value})}
                  >
                    <option value="" className="text-gray-800">Selecciona un día</option>
                    {daysOfWeek.map(day => (
                      <option key={day.value} value={day.value} className="text-gray-800">
                        {day.label}
                      </option>
                    ))}
                  </select>
                </>
              )}
              
              {modalType === 'agenda' && (
                <>
                  <input
                    type="date"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                    value={newItem.date}
                    onChange={(e) => setNewItem({...newItem, date: e.target.value})}
                  />
                  <input
                    type="time"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                    value={newItem.time}
                    onChange={(e) => setNewItem({...newItem, time: e.target.value})}
                  />
                  <select
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                    value={newItem.eventType}
                    onChange={(e) => setNewItem({...newItem, eventType: e.target.value})}
                  >
                    <option value="" className="text-gray-800">Tipo de evento</option>
                    <option value="Examen" className="text-gray-800">Examen</option>
                    <option value="Reunión" className="text-gray-800">Reunión</option>
                    <option value="Visita" className="text-gray-800">Visita</option>
                    <option value="Tarea" className="text-gray-800">Tarea</option>
                    <option value="Evento" className="text-gray-800">Evento</option>
                  </select>
                  <input
                    type="text"
                    placeholder="Asignatura"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3 placeholder-gray-400"
                    value={newItem.subject}
                    onChange={(e) => setNewItem({...newItem, subject: e.target.value})}
                  />
                  <textarea
                    placeholder="Comentarios"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4 placeholder-gray-400 resize-none"
                    rows="3"
                    value={newItem.comments}
                    onChange={(e) => setNewItem({...newItem, comments: e.target.value})}
                  />
                </>
              )}
              
              {modalType === 'reward' && (
                <>
                  <input
                    type="text"
                    placeholder="Nombre de la recompensa"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3 placeholder-gray-400"
                    value={newItem.name}
                    onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                  />
                  <input
                    type="number"
                    placeholder="Costo en puntos"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4 placeholder-gray-400"
                    value={newItem.cost}
                    onChange={(e) => setNewItem({...newItem, cost: e.target.value})}
                  />
                </>
              )}
              
              <div className="flex space-x-3">
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={() => setShowAddModal(false)}
                  className="flex-1 bg-gray-600 text-white py-2 rounded-lg font-medium"
                >
                  Cancelar
                </motion.button>
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={addNewItem}
                  className="flex-1 bg-gradient-to-r from-green-500 to-blue-500 text-white py-2 rounded-lg font-medium"
                >
                  Añadir
                </motion.button>
              </div>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Edit Modal for Agenda AND Daily Activities (UNIFICADO) */}
      <AnimatePresence>
        {showEditModal && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"
            onClick={() => setShowEditModal(false)}
          >
            <motion.div
              initial={{ scale: 0.8, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.8, opacity: 0 }}
              className="bg-gray-900 rounded-2xl p-6 w-full max-w-sm border border-white/20"
              onClick={(e) => e.stopPropagation()}
            >
              <h2 className="text-xl font-bold text-white mb-4 text-center">
                Editar {modalType === 'daily' ? 'Actividad' : 'Evento'}
              </h2>
              
              {/* Contenido para Actividades Diarias */}
              {modalType === 'daily' && (
                <>
                  <input
                    type="text"
                    placeholder="Nombre de la actividad"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3 placeholder-gray-400"
                    value={newItem.name}
                    onChange={(e) => setNewItem({...newItem, name: e.target.value})}
                  />
                  <input
                    type="number"
                    placeholder="Puntos de recompensa"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4 placeholder-gray-400"
                    value={newItem.cost}
                    onChange={(e) => setNewItem({...newItem, cost: e.target.value})}
                  />
                </>
              )}

              {/* Contenido para Agenda */}
              {modalType === 'agenda' && (
                <>
                  <input
                    type="date"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                    value={newItem.date}
                    onChange={(e) => setNewItem({...newItem, date: e.target.value})}
                  />
                  <input
                    type="time"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                    value={newItem.time}
                    onChange={(e) => setNewItem({...newItem, time: e.target.value})}
                  />
                  <select
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                    value={newItem.eventType}
                    onChange={(e) => setNewItem({...newItem, eventType: e.target.value})}
                  >
                    <option value="Examen" className="text-gray-800">Examen</option>
                    <option value="Reunión" className="text-gray-800">Reunión</option>
                    <option value="Visita" className="text-gray-800">Visita</option>
                    <option value="Tarea" className="text-gray-800">Tarea</option>
                    <option value="Evento" className="text-gray-800">Evento</option>
                  </select>
                  <input
                    type="text"
                    placeholder="Asignatura"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3 placeholder-gray-400"
                    value={newItem.subject}
                    onChange={(e) => setNewItem({...newItem, subject: e.target.value})}
                  />
                  <textarea
                    placeholder="Comentarios"
                    className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4 placeholder-gray-400 resize-none"
                    rows="3"
                    value={newItem.comments}
                    onChange={(e) => setNewItem({...newItem, comments: e.target.value})}
                  />
                </>
              )}
              
              <div className="flex space-x-3">
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={() => setShowEditModal(false)}
                  className="flex-1 bg-gray-600 text-white py-2 rounded-lg font-medium"
                >
                  Cancelar
                </motion.button>
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={modalType === 'daily' ? updateDailyActivity : updateEvent}
                  className="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-2 rounded-lg font-medium"
                >
                  Guardar
                </motion.button>
              </div>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Edit Modal for Schedule (Sin cambios) */}
      <AnimatePresence>
        {showEditScheduleModal && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"
            onClick={() => setShowEditScheduleModal(false)}
          >
            <motion.div
              initial={{ scale: 0.8, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.8, opacity: 0 }}
              className="bg-gray-900 rounded-2xl p-6 w-full max-w-sm border border-white/20"
              onClick={(e) => e.stopPropagation()}
            >
              <h2 className="text-xl font-bold text-white mb-4 text-center">Editar Horario</h2>
              
              <input
                type="time"
                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                value={newItem.time}
                onChange={(e) => setNewItem({...newItem, time: e.target.value})}
              />
              <input
                type="time"
                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3"
                value={newItem.endTime}
                onChange={(e) => setNewItem({...newItem, endTime: e.target.value})}
              />
              <select
                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4"
                value={newItem.day}
                onChange={(e) => setNewItem({...newItem, day: e.target.value})}
              >
                {daysOfWeek.map(day => (
                  <option key={day.value} value={day.value} className="text-gray-800">
                    {day.label}
                  </option>
                ))}
              </select>
              <input
                type="text"
                placeholder="Actividad"
                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4 placeholder-gray-400"
                value={newItem.activity}
                onChange={(e) => setNewItem({...newItem, activity: e.target.value})}
              />
              
              <div className="flex space-x-3">
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={() => setShowEditScheduleModal(false)}
                  className="flex-1 bg-gray-600 text-white py-2 rounded-lg font-medium"
                >
                  Cancelar
                </motion.button>
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={updateScheduleItem}
                  className="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-2 rounded-lg font-medium"
                >
                  Guardar
                </motion.button>
              </div>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Edit Modal for Rewards (Sin cambios) */}
      <AnimatePresence>
        {showEditRewardModal && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"
            onClick={() => setShowEditRewardModal(false)}
          >
            <motion.div
              initial={{ scale: 0.8, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              exit={{ scale: 0.8, opacity: 0 }}
              className="bg-gray-900 rounded-2xl p-6 w-full max-w-sm border border-white/20"
              onClick={(e) => e.stopPropagation()}
            >
              <h2 className="text-xl font-bold text-white mb-4 text-center">Editar Recompensa</h2>
              
              <input
                type="text"
                placeholder="Nombre de la recompensa"
                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-3 placeholder-gray-400"
                value={newItem.name}
                onChange={(e) => setNewItem({...newItem, name: e.target.value})}
              />
              <input
                type="number"
                placeholder="Costo en puntos"
                className="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white mb-4 placeholder-gray-400"
                value={newItem.cost}
                onChange={(e) => setNewItem({...newItem, cost: e.target.value})}
              />
              
              <div className="flex space-x-3">
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={() => setShowEditRewardModal(false)}
                  className="flex-1 bg-gray-600 text-white py-2 rounded-lg font-medium"
                >
                  Cancelar
                </motion.button>
                <motion.button
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.95 }}
                  onClick={updateReward}
                  className="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-2 rounded-lg font-medium"
                >
                  Guardar
                </motion.button>
              </div>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};

export default App;
